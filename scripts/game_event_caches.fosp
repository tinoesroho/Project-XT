                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               

const uint16[]Pids_AllWeapon={(300),(122),(8),(22),(18),(404),(241),(313),(398),(388),(394),(10),(287),(299),(23),(405),(143),(351),(403),(500),(161),(162),(261),(353),(392),(94),(385),(242),(268),(354),(9),(296),(283),(352),(391),(332),(11),(400),(13),(12),(389),(395),(350),(355),(387),(16),(402),(390),(118),(401),(28),(120),(24),(406),(15),(233),(396),(397),(16),(402),(390),(118),(401),(28),(120),(24),(406),(15),(233),(396),(397),(159),(25),(26),(27),(79),(205),(365),(45),(19),(423),(426),(486),(4),(236),(517),(383),(319),(522),(7),(280),(320),(5),(20),(384),(6),(386),(115),(160),(399),(116),(292),(293),(496),(497),(235),(21),(234),(407)};
const uint16[]Pids_WeaponSmallGuns={(300),(122),(8),(22),(18),(404),(241),(313),(398),(388),(394),(10),(287),(299),(23),(405),(143),(351),(403),(500),(161),(162),(261),(353),(392),(94),(385),(242),(268),(354),(9),(296),(283),(352),(391),(332)};
const uint16[]Pids_WeaponPistols={(300),(122),(8),(22),(18),(404),(241),(313),(398),(388),(394)};
const uint16[]Pids_WeaponRifles={(10),(287),(299),(23),(405),(143),(351),(403),(500),(161),(162),(261),(353),(392)};
const uint16[]Pids_WeaponShotguns={(94),(385),(242),(268),(354)};
const uint16[]Pids_WeaponPistolMachineGun={(9),(296),(283),(352),(391),(332)};
const uint16[]Pids_WeaponBigGuns={(11),(400),(13),(12),(389),(395),(350),(355),(387)};
const uint16[]Pids_WeaponEnergo={(16),(402),(118),(401),(28),(120),(24),(406),(15),(233),(396),(397)};
const uint16[]Pids_WeaponLaser={(16),(402),(118),(401),(28),(120)};
const uint16[]Pids_WeaponPlasma={(24),(406),(15),(233)};
const uint16[]Pids_WeaponPulse={(396),(397)};
const uint16[]Pids_WeaponThrowing={(159),(25),(26),(27),(79),(205),(365),(45),(19),(423),(426),(486)};
const uint16[]Pids_WeaponGrenade={(159),(25),(26),(27)};
const uint16[]Pids_WeaponThrowingOther={(79),(205),(365),(45),(19),(423),(426),(486)};
const uint16[]Pids_WeaponMelee={(4),(236),(517),(383),(319),(522),(7),(280),(320),(5),(20),(384),(6),(386),(115),(160),(399),(116)};
const uint16[]Pids_WeaponCutting={(4),(236),(517),(383),(319),(522)};
const uint16[]Pids_WeaponPricking={(7),(280),(320)};
const uint16[]Pids_WeaponShock={(5),(20),(384),(6),(386),(115)};
const uint16[]Pids_WeaponElectric={(160),(399),(116)};
const uint16[]Pids_WeaponUnarmed={(292),(293),(496),(497),(235),(21),(234),(407)};
const uint16[]Pids_WeaponSpecial={(270),(393),(371),(372),(427),(489),(498),(290),(291),(518),(520),(530),(531),(421),(390)};

const uint16[]Pids_AllArmor={(74),(1),(379),(265),(2),(380),(240),(17),(381),(239),(3),(232),(348),(349),(113),(524)};
const uint16[]Pids_ArmorLight={(74),(1),(379),(265)};
const uint16[]Pids_ArmorMedium={(2),(380),(240),(17),(381),(239)};
const uint16[]Pids_ArmorHeavy={(3),(232),(348),(349)};
const uint16[]Pids_ArmorRobes={(113)};
const uint16[]Pids_ArmorSpecial={(524)};

const uint16[]Pids_AllAmmo={(359),(35),(36),(363),(360),(121),(29),(30),(33),(31),(111),(357),(34),(95),(358),(14),(37),(32),(382),(38),(39),(163),(361),(362)};
const uint16[]Pids_Ammo={(359),(35),(36),(363),(360),(121),(29),(30),(33),(31),(111),(357),(34),(95),(358)};
const uint16[]Pids_AmmoOther={(14),(37),(32),(382),(38),(39),(163),(361),(362)};
const uint16[]Pids_AmmoSpecial={(274)};

const uint16[]Pids_AllDrugs={(40),(48),(49),(109),(144),(260),(273),(525),(106),(124),(125),(310),(311),(469),(53),(87),(110),(259),(71),(81),(103),(378),(424)};
const uint16[]Pids_DrugsPreparations={(40),(48),(49),(109),(144),(260),(273),(525)};
const uint16[]Pids_DrugsAlcohol={(106),(124),(125),(310),(311),(469)};
const uint16[]Pids_Drugs={(53),(87),(110),(259)};
const uint16[]Pids_DrugsOther={(71),(81),(103),(378)};
const uint16[]Pids_DrugsSpecial={(334),(473),(480),(481),(482),(424)};

const uint16[]Pids_MiscExplosions={(51),(85),(544)};
const uint16[]Pids_MiscActiveExplosions={(206),(209),(545),(222)};
const uint16[]Pids_MiscPartsBasic={(98),(92),(127),(271),(272),(276),(277),(278),(284),(285),(286),(318),(416),(542),(532),(534),(475),(535),(536),(537),(538),(50),(449),(539),(541)};
const uint16[]Pids_MiscPartsSelfSpecial={(89),(222),(229),(307),(419),(454),(364),(422),(479),(488)};
const uint16[]Pids_MiscPartsSpecial={(55),(253),(254),(258),(269),(356),(377)};
const uint16[]Pids_MiscPartsBody={(114),(251),(281),(282),(321),(322),(323),(324),(429),(484),(485),(507)};
const uint16[]Pids_MiscAllTools={(75),(77),(84),(308),(410),(411),(412),(47),(91),(408),(409),(428),(440),(289),(297),(543)};
const uint16[]Pids_MiscToolsTech={(75),(77),(84),(308),(410),(411),(412)};
const uint16[]Pids_MiscToolsMediacal={(47),(91),(408),(409),(428),(440)};
const uint16[]Pids_MiscToolsOther={(289),(297),(543)};
const uint16[]Pids_MiscToolsSpecial={(52),(54),(59)};
const uint16[]Pids_MiscOther={(101),(117),(126),(226),(227),(262),(295),(314),(315),(316),(317),(325),(326),(436),(437)};  

import string GetCode(Item&item)from"electronic_lock";
import void GenerateCode(Item&item)from"electronic_lock"; 

uint e_StatusOn(uint[]@values)
{
	GameVar@status=GetGlobalVar((1823));
	status=1;
	return 0;
} 

void r_GiveCart(Critter&player,Critter@npc)
{
	Item@item=player.AddItem((523),1);
	if((@item!=null))
	{
		GenerateCode(item);
		item.Info=2;
		item.Val1=Random(0,parameters.length()-1);
		item.Val2=3;
		item.SetLexems("$location@msg gm "+(((parameters[item.Val1][0][0])+100)*1000+0)+"@$code"+GetCode(item));
		item.SetScript("_TreasureMapInit");
		item.Update();
		GameVar@qItem=GetLocalVar((1000),item.Id);
		if((@qItem!=null))
		qItem=1;
	}
}

void _TreasureMapInit(Item&item,bool firstTime)
{
	item.SetEvent((0),"_TreasureMapFinish");
}

void _TreasureMapFinish(Item&item,bool deleted)
{
	if(deleted&&IsAnyData("ELock_"+item.Id))
	EraseAnyData("ELock_"+item.Id);
}

const uint16[]containerPids={42,43,44,66,67,68,69,70,128,129,130,131,132,133,134,135,157,180,188,189};          

void PlaceLoot2Container(Map&map,Critter&cr)
{
	Location@loc=map.GetLocation();
	if((@loc!=null))
	{
		GameVar@isEnc=GetLocalVar((18),loc.Id);
		GameVar@checked=GetLocalVar((17),loc.Id);
		if((@isEnc!=null)&&isEnc==1&&(@checked!=null)&&checked==0)
		{
			Item@[]items;
			Item@[]containers;
			Item@container;
			if(cr.GetItems(-1,items)>0)
			{
				for(uint i=0,l=items.length();i<l;i++)
				{
					Item@item=items[i];
					if((@item!=null)&&item.GetProtoId()==(523))
					{
						GameVar@isQuestItem=GetLocalVar((1000),item.Id);
						if(isQuestItem==1)
						{
							checked=1; 
							
							@container=GetValidContainer(loc);
							Location@locWhere=GetLocationByPid(parameters[item.Val1][0][0],0);
							if((@container!=null)&&(@locWhere!=null)&&GlobalDistance(locWhere,loc)<__GlobalMapZoneLength*2)
							{
								isQuestItem=0;
								CreateTimeEvent(__FullSecond+((1)*__TimeMultiplier*3600),"e_DeleteItem",item.Id,true);
								container.Val0=item.Id;
								container.Val2=0;
								container.SetScript("electronic_lock@_LockedInit");
								for(uint i2=0;i2<parameters[item.Val1][1].length();i2+=2)
								container.AddItem(parameters[item.Val1][1][i2],parameters[item.Val1][1][i2+1],0);
								
								if(parameters[item.Val1].length()>2)
								{
									if(parameters[item.Val1][2].length()>=3)
									{
										int pid=0;
										switch(parameters[item.Val1][2][0])
										{
											case(1):
											pid=Pids_WeaponSmallGuns[Random(0,Pids_WeaponSmallGuns.length()-1)];
											break;
											case(2):
											pid=Pids_WeaponPistols[Random(0,Pids_WeaponPistols.length()-1)];
											break;
											case(3):
											pid=Pids_WeaponRifles[Random(0,Pids_WeaponRifles.length()-1)];
											break;
											case(4):
											pid=Pids_WeaponUnarmed[Random(0,Pids_WeaponUnarmed.length()-1)];
											break;
											case(5):
											pid=Pids_ArmorMedium[Random(0,Pids_ArmorMedium.length()-1)];
											break;
											case(6):
											pid=Pids_AmmoOther[Random(0,Pids_AmmoOther.length()-1)];
											break;
											case(7):
											pid=Pids_Drugs[Random(0,Pids_Drugs.length()-1)];
											break;
										}
										if(pid>0)
										{
											container.AddItem(pid,Random(parameters[item.Val1][2][1],parameters[item.Val1][2][2]),0);
										}
									}
								}
								
								cr.SayMsg((11),(0),7115);
							}
							
						}
						return;
					}
				}
			}
		}
	}
}

uint GlobalDistance(Location@loc1,Location@loc2)
{
	if(!(@loc1!=null)||!(@loc2!=null))
	return 0;
	return uint((sqrt((((loc1.WorldX)-(loc2.WorldX))*((loc1.WorldX)-(loc2.WorldX)))+(((loc1.WorldY)-(loc2.WorldY))*((loc1.WorldY)-(loc2.WorldY))))));
}

uint e_DeleteItem(uint[]@values)
{
	Item@item=GetItem(values[0]);
	if((@item!=null))
	DeleteItem(item);
	return 0;
} 

Item@GetValidContainer(Location&loc)
{
	Map@map;
	Item@[]containers;
	Item@[]validContainers;
	for(uint i=0,l=loc.GetMapCount();i<l;i++)
	{
		@map=loc.GetMapByIndex(i);
		if((@map!=null))
		map.GetItemsByType((8),containers);
	}
	for(uint i=0,l=containers.length();i<l;i++)
	{
		if(containerPids.find(containers[i].GetProtoId())>=0)
		validContainers.insertLast(containers[i]);
	}
	if(validContainers.length()==0)
	return null;
	return validContainers[Random(0,validContainers.length()-1)];
}

uint[][][]parameters=
{
	{
		{(16)},
		{(74),1,(18),1,(31),100,(41),500,(40),5},
		{(7),1,2}
	},
	{
		{(16)},
		{(385),1,(95),1,(31),100,(41),500,(40),3},
		{(2),1,1}
	},
	{
		{(2)},
		{(74),1,(10),1,(34),50,(41),800,(106),2,(310),1},
		{(4),1,1}
	},
	{
		{(1)},
		{(74),1,(386),1,(378),1,(41),1000,(125),2,(40),5},
		{(3),1,1}
	},
	{
		{(13)},
		{(379),1,(23),1,(36),300,(41),1200,(40),5,(49),2},
		{(6),50,90}
	},
	{
		{(3)},
		{(1),1,(22),1,(33),100,(41),1000,(40),5,(273),2,(532),3},
		{(3),1,1}
	},
	{
		{(22)},
		{(379),1,(143),1,(34),100,(41),3000,(40),10,(87),1},
		{(7),4,5}
	},
	{
		{(22)},
		{(265),1,(236),1,(160),1,(41),1500,(40),5,(259),10,(605),2},
		{(5),1,1}
	},
	{
		{(7)},
		{(2),1,(242),1,(95),300,(41),1500,(40),5,(235),1},
		{(2),1,1}
	},
	{
		{(6)},
		{(380),1,(241),1,(34),100,(41),1600,(40),5,(144),2,(234),1},
		{(3),1,1}
	},
	{
		{(5)},
		{(585),1,(351),1,(14),10,(41),1500,(40),5,(13),1},
		{(1),1,1}
	},
	{
		{(4)},
		{(240),1,(353),1,(25),10,(41),1500,(40),10,(53),4},
		{(5),1,1}
	},
	{
		{(10)},
		{(17),1,(12),1,(36),500,(41),3500,(144),5,(53),2,(26),5},
		{(6),200,250}
	},
	{
		{(14)},
		{(239),1,(11),1,(382),10,(41),4500,(144),5,(109),3,(358),200,(394),1},
		{(7),3,5}
	}
};
